<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.game.mybatis.dao.Battle_InfoMapper" >
  <resultMap id="BattleResultMap" type="com.game.mybatis.model.Battle_Info" >
    <id column="battle_id" property="battle_id" jdbcType="INTEGER" />
    <result column="battle_name" property="battle_name" jdbcType="VARCHAR" />
    <result column="type" property="type" jdbcType="INTEGER" />
    <result column="UserCount" property="userCount" jdbcType="INTEGER" />
    <association property="playMap" column="play_Map_id" javaType="Map_Info"
    		resultMap="com.game.mybatis.dao.Map_InfoMapper.MapResult">
    </association>
    <association property="current_dialog_Info" column="current_dialog_Info_id" javaType="Dialog_Info"
    		resultMap="com.game.mybatis.dao.Dialog_InfoMapper.DialogInfoResultMap">
    </association>
    <collection property="userList" ofType="User" 
    	resultMap="com.game.mybatis.dao.UserMapper.UserResult">
    </collection>
    <collection property="dialogList" ofType="Dialog_Info" 
    	resultMap="com.game.mybatis.dao.Dialog_InfoMapper.DialogInfoResultMap">
    </collection>
  </resultMap>
  
  <select id="selectById" resultMap="BattleResultMap" parameterType="java.lang.Integer" >
    select b.*,m.*,d.*, u_l.*, d_l.* 
    from battle_info b left join map_info m on m.map_id = b.play_map_id
    left join dialog_info d on d.dialog_id = b.current_dialog_Info_id
    left join dialog_info d_l on d_l.type = 1 and d_l.group_id = b.battle_id
    left join user u_l on u_l.battle_info_id = b.battle_id
    where b.battle_id = #{id}
  </select>
  <delete id="deleteById" parameterType="java.lang.Integer" >
    delete from battle_info
    where battle_id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insertBattleInfo" parameterType="com.game.mybatis.model.Battle_Info" >
    insert into battle_info (battle_id, battle_name, type, UserCount, play_map_id, current_dialog_Info_id)
    values (#{battle_id}, #{battle_name}, #{type}, #{userCount}, #{playMap.mapId}, #{current_dialog_Info.dialog_id})
  </insert>
  <update id="updateBattleInfo" parameterType="com.game.mybatis.model.Battle_Info" >
    update battle_info
    <set >
      <if test="battle_name != null" >
        battle_name = #{battle_name},
      </if>
      <if test="userCount != null" >
        UserCount = #{userCount},
      </if>
      <if test="type != null" >
        type = #{type},
      </if>
      <if test="playMap != null" >
        play_map_id = #{playMap.mapId},
      </if>
      <if test="current_dialog_Info != null" >
        current_dialog_Info_id = #{current_dialog_Info.dialog_id},
      </if>
      
    </set>
    where battle_id = #{battle_id}
  </update>
</mapper>